# CtxOS Engines Configuration
# Configure scoring engines (Risk, Exposure, Drift)

engines:
  enabled: true
  default_engine: risk
  
  # Risk Engine Configuration
  risk:
    enabled: true
    version: "1.0.0"
    description: "Assess risk of entities based on signals and properties"
    
    # Component weights (must sum to 100)
    weights:
      vulnerability_weight: 25
      open_ports_weight: 15
      exposure_weight: 20
      activity_weight: 40
    
    # Age decay factor (reduce score by percentage per 100 days)
    age_decay: 0.1
    
    # Severity multipliers
    severity_multipliers:
      critical: 1.5
      high: 1.2
      medium: 1.0
      low: 0.8
      info: 0.5
    
    # Thresholds for recommendations
    thresholds:
      critical_score: 80
      high_score: 60
      medium_score: 40
      low_score: 20

  # Exposure Engine Configuration
  exposure:
    enabled: true
    version: "1.0.0"
    description: "Score asset exposure and attack surface"
    
    # Component weights (must sum to 100)
    weights:
      public_weight: 30
      service_weight: 25
      protocol_weight: 20
      subdomain_weight: 25
    
    # Security controls reduction factors (multipliers)
    security_controls:
      waf_factor: 0.7
      cdn_factor: 0.8
      authentication_factor: 0.75
      security_headers_factor: 0.85
    
    # Exposure type scores
    exposure_scores:
      dns: 10
      certificate: 15
      http: 25
      https: 15
      ftp: 30
      ssh: 20
      rdp: 35
      smtp: 25
      dns_server: 35
      web_service: 30
      database: 40
      api: 25
    
    # High-risk protocols
    high_risk_protocols:
      - rdp
      - ftp
      - telnet
      - http  # Unencrypted

  # Drift Engine Configuration
  drift:
    enabled: true
    version: "1.0.0"
    description: "Detect and score configuration changes over time"
    
    # Component weights (can be flexible)
    weights:
      property_change_weight: 30
      signal_change_weight: 40
      velocity_weight: 30
    
    # Unexpected change multiplier
    unexpected_change_multiplier: 1.5
    
    # Threshold for tracking baseline
    drift_threshold_days: 7
    
    # Critical properties to monitor
    critical_properties:
      - dns_servers
      - authentication_method
      - firewall_rules
      - ssl_certificate
      - ip_address
      - service_ports
      - admin_contacts
      - encryption_type
    
    # Velocity thresholds (changes per day)
    velocity_thresholds:
      normal: 0.5
      elevated: 1.0
      critical: 2.0

# Engine orchestration
orchestration:
  # Run engines in sequence or parallel
  execution_mode: parallel
  
  # Combine engine results
  result_combination:
    # average, max, weighted_average
    method: weighted_average
    weights:
      risk: 0.4
      exposure: 0.35
      drift: 0.25
  
  # Timeout for engine execution
  engine_timeout_seconds: 30
  
  # Retry failed engines
  retry_on_failure: true
  max_retries: 2

# Scoring scale (0-100)
scoring_scale:
  critical: 80-100
  high: 60-79
  medium: 40-59
  low: 20-39
  info: 0-19

# Logging and monitoring
logging:
  enabled: true
  log_level: INFO
  log_file: logs/engines.log
  
monitoring:
  enabled: true
  track_metrics: true
  alert_on_failures: true
